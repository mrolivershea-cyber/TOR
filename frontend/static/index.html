<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexa Proxy - Admin Panel</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê Connexa Proxy</h1>
            <div id="user-info" style="display:none;">
                <span id="username"></span>
                <button onclick="showOptionsMenu()" class="btn btn-secondary" id="options-btn">‚öôÔ∏è Options</button>
                <button onclick="logout()" class="btn btn-secondary">Logout</button>
            </div>
        </header>

        <!-- Options Menu (dropdown) -->
        <div id="options-menu" class="options-menu" style="display:none;">
            <div class="options-menu-item" onclick="showChangePasswordModal()">
                üîë Change Password
            </div>
            <div class="options-menu-item" onclick="showWhitelistModal()">
                üõ°Ô∏è Manage IP Whitelist
            </div>
        </div>

        <!-- Login Form (Compact) -->
        <div id="login-section" class="section login-section">
            <div class="login-box">
                <h2>Login</h2>
                <form id="login-form" onsubmit="login(event)">
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="login-username" value="admin" required>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="login-password" value="admin" required>
                    </div>
                    <div class="form-group" id="totp-group" style="display:none;">
                        <label>2FA Code:</label>
                        <input type="text" id="totp-token" placeholder="123456">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Login</button>
                    <div id="login-error" class="error"></div>
                </form>
            </div>
        </div>

        <!-- Password Change Modal -->
        <div id="password-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeModal('password-modal')">&times;</span>
                <h2>Change Password</h2>
                <form id="password-change-form" onsubmit="changePassword(event)">
                    <div class="form-group">
                        <label>Current Password:</label>
                        <input type="password" id="old-password" required>
                    </div>
                    <div class="form-group">
                        <label>New Password:</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Change Password</button>
                    <div id="password-error" class="error"></div>
                </form>
            </div>
        </div>

        <!-- IP Whitelist Modal -->
        <div id="whitelist-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeModal('whitelist-modal')">&times;</span>
                <h2>Manage IP Whitelist</h2>
                <div class="form-group">
                    <label>Add IP Address or CIDR:</label>
                    <input type="text" id="whitelist-ip" placeholder="192.168.1.100 or 10.0.0.0/24">
                    <button onclick="addWhitelistIP()" class="btn btn-primary">Add IP</button>
                </div>
                <div id="whitelist-list" class="whitelist-list"></div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard-section" class="section" style="display:none;">
            <!-- Dashboard Header with Actions -->
            <div class="dashboard-header">
                <div class="stats-compact">
                    <div class="stat-mini">
                        <span class="stat-label">Total</span>
                        <span class="stat-num" id="total-nodes">-</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-label">Healthy</span>
                        <span class="stat-num" id="healthy-nodes">-</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-label">Health</span>
                        <span class="stat-num" id="health-percent">-</span>
                    </div>
                </div>
                <div class="actions-compact">
                    <label class="scale-label">
                        Scale to: 
                        <input type="number" id="scale-size" min="1" max="100" value="50" class="scale-input">
                        <button onclick="scalePool()" class="btn btn-sm btn-primary">Scale</button>
                    </label>
                    <button onclick="rotateAll()" class="btn btn-sm btn-primary">üîÑ Rotate All</button>
                    <button onclick="refreshData()" class="btn btn-sm btn-secondary">‚Üª Refresh</button>
                </div>
            </div>

            <!-- Nodes Table -->
            <div class="nodes-table-container">
                <table class="nodes-table">
                    <thead>
                        <tr>
                            <th>Node ID</th>
                            <th>SOCKS Port</th>
                            <th>Control Port</th>
                            <th>Exit IP</th>
                            <th>Country</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="nodes-table-body">
                        <tr>
                            <td colspan="7" style="text-align:center;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Bottom tabs for other features -->
            <div class="bottom-tabs">
                <button class="bottom-tab-btn" onclick="showBottomTab('config')">‚öôÔ∏è Configuration</button>
                <button class="bottom-tab-btn" onclick="showBottomTab('export')">üì§ Export Tokens</button>
            </div>

            <!-- Configuration Panel (collapsible) -->
            <div id="config-panel" class="bottom-panel" style="display:none;">
                <h3>Configuration</h3>
                <div id="config-info"></div>
                <div class="actions">
                    <button onclick="applyFirewall()" class="btn btn-primary">Apply Firewall Rules</button>
                </div>
            </div>

            <!-- Export Tokens Panel (collapsible) -->
            <div id="export-panel" class="bottom-panel" style="display:none;">
                <h3>Export Tokens</h3>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="token-description" placeholder="My Application">
                    <button onclick="createToken()" class="btn btn-primary">Create Token</button>
                </div>
                <div id="tokens-list"></div>
            </div>
        </div>
    </div>

    <div id="message" class="message"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
