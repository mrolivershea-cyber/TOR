<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexa Proxy - Admin Panel</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🔐 Connexa Proxy</h1>
            <div id="user-info" style="display:none;">
                <span id="username"></span>
                <button onclick="showOptionsMenu()" class="btn btn-secondary" id="options-btn">⚙️ Options</button>
                <button onclick="logout()" class="btn btn-secondary">Logout</button>
            </div>
        </header>

        <!-- Options Menu (dropdown) -->
        <div id="options-menu" class="options-menu" style="display:none;">
            <div class="options-menu-item" onclick="showChangePasswordModal()">
                🔑 Change Password
            </div>
            <div class="options-menu-item" onclick="showWhitelistModal()">
                🛡️ Manage IP Whitelist
            </div>
        </div>

        <!-- Login Form (Compact) -->
        <div id="login-section" class="section login-section">
            <div class="login-box">
                <h2>Login</h2>
                <form id="login-form" onsubmit="login(event)">
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="login-username" value="admin" required>
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="login-password" value="admin" required>
                    </div>
                    <div class="form-group" id="totp-group" style="display:none;">
                        <label>2FA Code:</label>
                        <input type="text" id="totp-token" placeholder="123456">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Login</button>
                    <div id="login-error" class="error"></div>
                </form>
            </div>
        </div>

        <!-- Password Change Modal -->
        <div id="password-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeModal('password-modal')">&times;</span>
                <h2>Change Password</h2>
                <form id="password-change-form" onsubmit="changePassword(event)">
                    <div class="form-group">
                        <label>Current Password:</label>
                        <input type="password" id="old-password" required>
                    </div>
                    <div class="form-group">
                        <label>New Password:</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Change Password</button>
                    <div id="password-error" class="error"></div>
                </form>
            </div>
        </div>

        <!-- IP Whitelist Modal -->
        <div id="whitelist-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span class="close" onclick="closeModal('whitelist-modal')">&times;</span>
                <h2>Manage IP Whitelist</h2>
                <div class="form-group">
                    <label>Add IP Address or CIDR:</label>
                    <input type="text" id="whitelist-ip" placeholder="192.168.1.100 or 10.0.0.0/24">
                    <button onclick="addWhitelistIP()" class="btn btn-primary">Add IP</button>
                </div>
                <div id="whitelist-list" class="whitelist-list"></div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard-section" class="section" style="display:none;">
            <!-- Stats Row -->
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-label">Total Nodes</div>
                    <div class="stat-value" id="total-nodes">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Healthy Nodes</div>
                    <div class="stat-value" id="healthy-nodes">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Health %</div>
                    <div class="stat-value" id="health-percent">-</div>
                </div>
            </div>

            <!-- Control Panel Above Table -->
            <div class="control-panel">
                <div class="control-group">
                    <label>Scale Pool:</label>
                    <input type="number" id="scale-size" min="1" max="100" value="50" class="input-sm">
                    <button onclick="scalePool()" class="btn btn-sm btn-primary">Apply</button>
                </div>
                <div class="control-group">
                    <label>Exit Countries:</label>
                    <select id="exit-countries" multiple class="select-countries">
                        <option value="US">🇺🇸 United States</option>
                        <option value="DE">🇩🇪 Germany</option>
                        <option value="GB">🇬🇧 United Kingdom</option>
                        <option value="FR">🇫🇷 France</option>
                        <option value="NL">🇳🇱 Netherlands</option>
                        <option value="CA">🇨🇦 Canada</option>
                        <option value="SE">🇸🇪 Sweden</option>
                        <option value="CH">🇨🇭 Switzerland</option>
                        <option value="JP">🇯🇵 Japan</option>
                        <option value="SG">🇸🇬 Singapore</option>
                    </select>
                    <button onclick="setExitCountries()" class="btn btn-sm btn-primary">Set Countries</button>
                </div>
                <div class="control-group">
                    <button onclick="rotateAll()" class="btn btn-sm btn-success">🔄 Rotate All Circuits</button>
                    <button onclick="refreshData()" class="btn btn-sm btn-secondary">↻ Refresh</button>
                    <button onclick="showConfigPanel()" class="btn btn-sm btn-info">⚙️ Configuration</button>
                    <button onclick="showExportPanel()" class="btn btn-sm btn-warning">📤 Export Tokens</button>
                </div>
            </div>

            <!-- Nodes Table -->
            <div class="nodes-table-container">
                <table class="nodes-table">
                    <thead>
                        <tr>
                            <th>Node ID</th>
                            <th>SOCKS Port</th>
                            <th>Control Port</th>
                            <th>Exit IP</th>
                            <th>Country</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="nodes-table-body">
                        <tr>
                            <td colspan="7" style="text-align:center;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Configuration Modal -->
            <div id="config-modal" class="modal" style="display:none;">
                <div class="modal-content modal-large">
                    <span class="close" onclick="closeModal('config-modal')">&times;</span>
                    <h2>⚙️ Configuration</h2>
                    <div id="config-info" class="config-display"></div>
                    <div class="modal-actions">
                        <button onclick="applyFirewall()" class="btn btn-primary">Apply Firewall Rules</button>
                        <button onclick="closeModal('config-modal')" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>

            <!-- Export Tokens Modal -->
            <div id="export-modal" class="modal" style="display:none;">
                <div class="modal-content modal-large">
                    <span class="close" onclick="closeModal('export-modal')">&times;</span>
                    <h2>📤 Export Tokens</h2>
                    <div class="form-group">
                        <label>Token Description:</label>
                        <input type="text" id="token-description" placeholder="My Application" class="input-full">
                        <button onclick="createToken()" class="btn btn-primary">Create Token</button>
                    </div>
                    <h3>Active Tokens</h3>
                    <div id="tokens-list" class="tokens-display"></div>
                    <div class="modal-actions">
                        <button onclick="closeModal('export-modal')" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="message" class="message"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
